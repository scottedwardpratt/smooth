\documentclass[main.tex]{subfiles}
\begin{document}
\newpage
\setcounter{section}{2}

\section{Simplex Sampler}

\subsection{Summary}
Simplex Sampler produces a list of points in model-parameter space to be used for training an emulator. The algorithms are based on the $n-$dimensional simplex. For example, in two dimensions the points are arranged in an equilateral triangle, and for three dimensions of parameters points are arranged in a tetrahedron. The program reads a simple text file that provides the names of model parameters and the range of their prior distribution. Simple sampler also takes input from a text file providing the User several choices, such as choosing which algorithm to apply when generating the training points, or the directory name for writing the points. Given the choice of algorithm, Simplex Sampler determines the number of training points based on the algorithm.

\subsection{Simplex Parameters (not model parameters!)}

This refers to parameters Simplex Sampler uses when generating the training points, e.g. a choice of specific algorithm. It does not refer to information about model parameters. To access the simplex parameter file one should go to their project directory and follow the steps listed below. Here the {\it project directory} is the location from which Simplex will be run. One should first edit the parameters text file. For example, in the template the parameters file is {\tt parameters/simplex\_parameters.txt}, where the path is relative to the project directory.
Parameters files can have any name or location. These files are text files in the format. An example of a parameter file is:\\
{\tt\begin{verbatim}
 Simplex_TrainType             1                   # Must be 1 or 2 or 3
 Simplex_RTrain                0.95                # Radius of simplex
 Simplex_ModelRunDirName       modelruns           # Directory with training
                                                           point information
 Simplex_ModelParInfoFileName  Info/prior_info.txt # Describes model parameters
\end{verbatim}
}
For the parameter file, the first string is the parameter name and is followed by the value. Both are single strings (without spaces). The \# symbol is used for comments. Each parameter has a default value, which will be used if the parameter is not mentioned in the parameter file.  Simplex Sampler has four User-defined parameters.
    
\begin{enumerate}\itemsep 0pt
    \item {\bf Simplex\_TrainType}\\
Possible values are ``1'', ``2'' or ``3''. The default, ``1'', will position points according to a simplex, i.e. in two dimensions this is an equilateral triangle and in three dimensions, it is a tetrahedron. In $n$ dimensions there are $n+1$ points separated at equal distances from one another and centered at the origin. 
\item {\bf Simplex\_RTrain}\\
This sets the distance from the origin that the training points will be selected throughout the parameter space. The default is 0.95.
\item {\bf Simplex\_ModelRunDirName}\\
This sets the path file that the run files will be created in. The default name is {\tt{modelruns}}, but the user can change this to anything they want. The default is ``modeldirs''. The path is relative to the project directory, i.e. the directory from which you run the {\it simplex} command.
\item {\bf Simplex\ ModelParInfoFileName}\\
This file describes which model parameters will be varied in the analysis, along with their ranges, or priors. The default is {\tt Info/prior\_info.txt}, where the path is relative to the project directory.
\end{enumerate}

\subsection{Specifying Model Parameters and Priors}

Before proceeding, Simplex requires information about the parameters, specifically, their ranges. That file is defined by the {\tt Simplex\_ModelParPriorInfoFile} parameter mentioned above. An example of such a file might be
{\tt\begin{verbatim}
   GroundConductivity  uniform     300    1500
   OceanReflectivity   uniform     1.15   1.45
   CloudReflectivity   gaussian    4.0    2.9
   Viscosity           uniform     0.08   0.24
\end{verbatim}
}
The first column is the model-parameter name, and the last three parameters describe the range of the parameters, which is usually the prior, assuming the prior is uniform or Gausian. The second entry for each parameter defines whether the range/prior is uniform or {\tt gaussian}. If the prior is {\tt uniform}, the next two numbers specify the lower and upper ranges of the parameter. If the range/prior is {\tt gaussian}, the third entry describes the center of the Gaussian, $\theta_0$, and the fourth entry describes the Gaussian width, $\sigma_0$, where the prior distribution is $\propto \exp\{-(\theta-\theta_0)^2/2\sigma_0^2\}$. Simplex will read the information to determine the number of parameters. It will then assign the points assuming each model parameter has a range from -1 to 1, then translate and scale the points according to the ranges/priors defined in the file.

\subsection{Training Types}

\subsubsection{Type 1}
 Depending on the number of parameters, $N$, the program creates a simplex in $N$ dimensions. This simplex's vertices will be used to generate new training points. These points will be scaled by different values so the training points aren't in the same radius. This results in the minimum number of required points for linear fits. Thus, the user might want to select this training type if their model is a linear one. 

\subsubsection{Type 2}

 Depending on the number of parameters, the program creates a simplex in $N$ dimensions. This simplex's vertices will be used to generate new training points there and along the edges. These points will be scaled to be in different radii from the center. This results in the minimum number of required points for quadratic fits. Thus, the user might want to select this training type if their model is a quadratic one.
 
\subsubsection{Type 3}
This training type creates two different simplexes to put them on top of each other in a reflected way. The 2-dimensional visualization of this would look like the "Star of David". The points created by the crossed edges are used as training points for the emulation.

\subsection{Running Simplex to Generate Training Points}

Simplex is a mathematical term that generalizes the notion of a triangle or a tetrahedron to arbitrary dimensions. The simplex method uses the vertices of simplexes to get training points at different radii along the edges. This method also is computationally cheap due to its iterative process.

To run the Simplex program, enter the following command from your project directory:
{\tt
\begin{verbatim}
    % SMOOTH_HOME/local/bin/simplex PARAMETER_FILE_NAME
\end{verbatim}
}
Here {\tt SMOOTH\_HOME} is the path to the Smooth Emulator installation, and {\tt PARAMETER\_FILE\_NAME} is the name of the simplex parameter file, e.g. {\tt parameters/simplex\_parameters.txt}. Paths are either absolute, or are relative to the project directory. 

Simplex will write the information about the training points in the directory defined by the {\tt Simplex\_ModelRunDirName} parameter. Within the directory, a sub-directory will be created for each training point, named {\tt run0/, run1/, run2/}$\cdots$. Within each subdirectory, Simplex creates a file {\tt runI/mod\_parameters.txt} for the I$^{\rm th}$ training point. For example, the {\tt run0/mod\_parameters.txt} file might be
{\tt\begin{verbatim}
   GroundConductivity     329.08
   OceanReflectivity      1.201
   CloudReflectivity      3.178
   Viscosity              0.192
\end{verbatim}
}
At this point, it is up to the User to run their full model at each training point and create a file {\tt runI/obs.txt}, which stores values of the observables at those training points as calculated by the full model. Once that is completed, one can begin the emulation procedure.

\end{document}
